# A Highly Non-Volatile Memory Scalable and Efficient File System

在本文中，我们提出了鼻子fs，一个高度非易失性内存可伸缩和高效的文件系统。它旨在通过一系列的技术实现高性能： (1)一个可扩展的轻量级命名集成VFS与底层文件系统名称空间，(2)一个细粒度的**字节单元文件索引树**避免冗余复制开销 copy on wrote，(3)一个轻量级日志提供原子性和可伸缩性，和(4)一个轻量级的原子映射提供强大的一致性保证低开销跟踪脏页面。实验结果表明，noneFS的性能远远优于最先进的文件系统，具有同样强的数据一致性保证，并在40核机器上实现了近线性的可扩展性。

主要的贡献：

- 一种专用的轻量级命名，以支持nvm上高效和可伸缩的目录操作。
- 一种轻量级的一致性机制，以提高文件系统在nvm上的操作性能。
  - NCOW由细粒度的字节单元文件索引树实现，以替代传统的块粒度组织（大小通常为4KB或更大），它的目的是消除COW更新文件数据时的复制开销。
  - 轻量级日志记录只记录nvm中的元数据地址，而不是nvm中的元数据内容，以进一步减少双元数据写入和粗数据线刷新所带来的开销。

noneFS中的文件结构是由广泛使用的**基于范围的B+树**（或简单的文件索引树）组织起来的。由于文件索引树可以从其叶节点重新构建，nonsFS在DRAM中构建它，**并且只将其叶节点（区段）保留在nvm中**，从而使nvm中的数据结构简单而高效。

NoneFS只存储nvm中的扩展区，并使用一个链接表来组织它们。

它的思路和一开始想的一样，空间的分配仍然是按照page-based，但写的数据可以按照字节粒度写一部分，然后内存构建细粒度的文件数据索引。

空间管理：为了缓解数据块的分配和释放争用，nonsFS将数据空间均匀划分为多个区域，每个CPU一个，并在DRAM中使用B+树来组织每个区域的自由数据块的地址。NoneFS首先从当前CPU的B-+树中分配数据块。如果没有可用的块，那么它将从其他cpu的B-+树中分配块。NoneFS使用每个区域的锁来支持并发操作。数据块被重新分配到其分配的B+树（原始数据区域），如果相邻的叶节点代表一个连续的空间，则合并叶节点，以增加大空间分配的可能性。

