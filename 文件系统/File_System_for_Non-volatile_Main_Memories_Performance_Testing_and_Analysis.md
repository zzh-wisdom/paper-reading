# File System for Non-volatile Main Memories Performance Testing and Analysis

摘要：近年来，新兴的存储技术正在推动计算机存储架构的发展。非易失性主存储器 (NVMM) 提供比 SRAM 更高的密度、像 DRAM 的访问性能和磁盘一样的持久性。它还可以在内存级别持久化数据。然而，传统的文档系统是基于块的，并且是为磁盘访问特性而设计的，无法有效地利用NVMM的字节寻址特性。因此，一些NVMM文档系统专注于内存级别的数据一致性研究。例如，与基于块的文档系统相比，NOVA 的设计优化了系统架构，避免了 DRAM 中的页面缓存和块层，同时提供了强大的数据一致性保证。在本文中，我们将 PMFS 和 NOVA 等最先进的 NVMM 文档系统与几种主流的传统文档系统进行了比较。然后，我们评估这些具有特定工作负载的文档系统并分析实验结果以得出一些有见地的结论。例如，NOVA 可以提供接近 PMFS 的写入性能，以及 NILFS2 的强数据一致性。当I/O大小达到4MB时，其随机写入性能分别达到Ext4的2.2倍、NILFS2的16.5倍和F2FS的4.4倍。

## introduction

新兴的非易失性存储器（NVM）技术，如相变[l]、自旋扭矩传递[2]、忆阻器[3]以及英特尔和美光的3D XPoint [5]，为存储系统的设计带来了巨大的变化。与传统内存相比，NVM 可以保证高容量、高密度、低延迟和非易失性，填补内存和磁盘之间的性能差距，为存储技术提供新的解决方案。

由于非易失性内存既可以像 DRAM 一样按字节寻址，也可以像磁盘一样持久化，因此可以使用 NVM 在内存级别持久化数据。持久内存最初被证明与 RAMDISK 类 NVMM 块设备上的传统文档系统兼容。但是，数据需要在页面缓存和 NVM 中复制两次，这可能会显着影响系统性能。因此，当前的文档系统通过将 NVM 直接连接到内存总线来访问 NVM 字节寻址能力，从而避免了 DRAM 和块层中的页面缓存。

针对 NVM 优化的系统架构改变了传统的存储模式。它还带来了**系统软件在 CPU 缓存模型和内存管理方面的变化**[4]。在传统的存储系统中，数据页缓存在DRAM中，由操作系统管理。因此，数据页是否持久以及它是什么状态对应用进程是透明的。由于 NVMM 在持久内存中直接暴露给 CPU，因此 CPU 缓存中的写入重新排序会影响 NVM 中的数据一致性。 CPU 内核中的易失性缓冲区和高速缓存将隐藏高速缓存和内存访问的延迟以提高性能，这将重新排列对 NVM 的写入串行，并在断电或系统崩溃后使数据不一致。因此，NVMM 文档系统对于 NVM 和相关数据结构应该有不同的设计和实现。

为了解决CPU缓存模式下写入重新排序的问题，NVMM文档系统应采取措施保持数据一致性。英特尔 x86 CPU 架构提供 clflush [5] 指令来刷新 CPU 高速缓存线，mfence 以确保正确的指令执行顺序，并且还建议使用其他指令来强制写入 NVM[6]。通过这样的方法，CPU提供了64位原子写入操作，以确保写入是有序和持久的，这是数据一致性的前提。传统文档系统中一致性问题的常见解决方案，如日志和写入时复制[7]，来自数据库管理系统。当前的 NVMM 感知文档系统开发了多种技术来平衡数据一致性开销和性能。BPFS[8]提出了短路影子分页，这是一种用于更新持久性数据的部分写入时复制技术。PMFS[IO] 为元数据更新实现原子就地更新和撤消日记功能。NOVA[II] 使用改进的日志结构和写入时复制策略来提供元数据和数据一致性。

结论：

1）与传统文档系统相比，NVMM文档系统在读取单个文档时的表现与传统文档系统相似。对于写入工作负载，我们可以发现就地更新更适合 NVM，它减少了数据的额外副本并利用了随机访问特性。而 NOVA 实现的改进日志结构可以提供与就地更新和数据一致性相当的性能。

## 背景

由于它可以帮助将访问延迟从毫秒减少到微秒甚至纳秒，非易失性存储器技术导致存储层次结构的变化。使用 NVM 代替磁盘也可以大大提升存储系统的性能。此外，它还带来了一些新的应用，例如使用 NVM 代替 DRAM、构建混合易失性或非易失性主存储器或使用 DRAM 缓存数据以更好地访问 NVM。然而，传统文档系统未能完全适用于 NVM 主要有以下几个原因：**首先，传统文档系统以块为单位管理数据，无法利用字节可寻址特性。更重要的是，传统系统中的大多数优化都是针对顺序读写而设计的**，而 NVM 与随机读写操作的区别不大。在传统系统中使用 NVM 还会引起额外的数据管理问题，**例如写放大、空间冗余**等问题。

